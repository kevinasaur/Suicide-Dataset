#%%

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
%matplotlib inline
import plotly.express as px

data = pd.read_csv('master.csv')

##Analysis of Data showed that there were alot of Nulls in HDI. Replacing with Mean for analysis. Also dropping country year - not neccessary. 
data.drop("country-year", axis=1, inplace=True)
data.fillna(data.mean(), inplace=True)
data.head()

#%%

## Dropping countries with no data and removing 2016 (no data)
data[data.country != 'Dominica']
data[data.country != 'Saint Kitts and Nevis']
data[data.year != 2016]

#%%

## Number strings with commas into integers
data[" gdp_for_year ($) "] = data[" gdp_for_year ($) "].str.replace(",", "").astype("int")
data.info()

#%%


## Converting objects into numerical labels
data[["country","age","sex","generation"]] = data[["country","age","sex","generation"]].astype("category")
columns = data.select_dtypes(['category']).columns
data[columns] = data[columns].apply(lambda fx: fx.cat.codes)
data.dtypes

#%%

##Review distribution of gender
sns.countplot(x='sex', data=data);
plt.title('Distribution of Gender');

#%%

##Distribution of Age
data['age'].value_counts().plot(kind='bar')
plt.title('Distribution of Age');

#%%

perc = data.loc[:,["year","country",'suicides_no']]
perc['total_suicides'] = perc.groupby([perc.country,perc.year])['suicides_no'].transform('sum')
perc.drop('suicides_no', axis=1, inplace=True)
perc = perc.drop_duplicates()
perc = perc[(perc['year']>=1990.0) & (perc['year']<=2012.0)]
perc = perc.sort_values("year",ascending = False)

top_countries = ['Russian Federation','United States','Japan','France',"Ukraine"] 
perc = perc.loc[perc['country'].isin(top_countries)]
perc = perc.sort_values("year")
fig=px.bar(perc,x='country', y="total_suicides", animation_frame="year", 
           animation_group="country", color="country", hover_name="country")
fig.show()

#%%

##Prevelance of Suicides among different age groups
age = data.loc[:,['year','age','suicides_no']]
age['total_suicides'] = age.groupby(['year','age'])['suicides_no'].transform('sum')
age.drop('suicides_no', axis=1, inplace=True)
age = age.drop_duplicates()
age = age[age['year']>=2000.0]
age = age.sort_values("year")
fig=px.bar(age,x='age', y="total_suicides", animation_frame="year", 
           animation_group="age", color="age", hover_name="age")
fig.show()

#%%

##Correlation Heat Map
sns.heatmap(data.corr(), annot=True)

#%%

## Relation between number of suicides and gdp_per_capita
fig = plt.figure(figsize=(20,7))
sns.scatterplot(data=data, x='gdp_per_capita ($)', y='suicides_no')

#%%

fig = plt.figure(figsize=(25,10))
sns.scatterplot('suicides/100k pop', 'population', hue='population', data=data);
plt.title('Suicides vs Suicides/100k pop, Colored by population');
